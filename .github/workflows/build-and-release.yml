name: Build Simulator

on:
  push:
    branches:
      - '**'  # Build on any branch
    paths:
      - 'src/**'
      - 'Makefile'
      - '.github/workflows/build-and-release.yml'
  pull_request:
    paths:
      - 'src/**'
      - 'Makefile'
  workflow_dispatch:

jobs:
  build-simulator:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential
    
    - name: Build simulator
      run: |
        make clean
        make
        mv slopOS slopos_sim
        chmod +x slopos_sim
    
    - name: Test simulator
      run: |
        echo "âœ… Simulator built successfully"
        ls -lh slopos_sim
    
    - name: Upload simulator artifact
      uses: actions/upload-artifact@v4
      with:
        name: slopos-simulator
        path: slopos_sim
        retention-days: 30
